Estructura de archivos
/Html/admin_profile.html
/Html/css/admin_profile.css
/Html/js/admin_profile.js
/server/server.js
/server/db.js
/server/controllers/adminController.js
/server/middleware/auth.js
/.env.example
/schema.sql
/README.md


/Html/admin_profile.html
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Perfil Administrador - Restaurante</title>
  <link rel="stylesheet" href="css/admin_profile.css">
</head>
<body>
  <header class="topbar">
    <h1 class="brand">Restaurante • Panel Admin</h1>
    <div class="right">
      <button id="logoutBtn" class="btn small">Cerrar sesión</button>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <div class="profile-mini">
        <img id="avatarMini" src="/images/default-avatar.png" alt="avatar">
        <div>
          <div id="adminName">Admin</div>
          <div class="muted">Administrador</div>
        </div>
      </div>

      <nav class="nav">
        <button class="nav-btn active" data-section="profile">Perfil</button>
        <button class="nav-btn" data-section="usuarios">Usuarios</button>
        <button class="nav-btn" data-section="menu">Menú</button>
        <button class="nav-btn" data-section="pedidos">Pedidos</button>
      </nav>
    </aside>

    <section class="content">

      <!-- Perfil -->
      <section id="section-profile" class="panel">
        <h2>Perfil</h2>
        <div class="card profile-card">
          <div class="left">
            <img id="avatar" src="/images/default-avatar.png" alt="avatar">
            <input id="avatarInput" type="file" accept="image/*" hidden>
            <button id="changeAvatar" class="btn">Cambiar foto</button>
          </div>
          <div class="right">
            <label>Nombre</label>
            <input id="name" type="text">
            <label>Email</label>
            <input id="email" type="email">
            <label>Teléfono</label>
            <input id="phone" type="text">

            <div class="actions">
              <button id="saveProfile" class="btn primary">Guardar cambios</button>
              <button id="changePasswordBtn" class="btn outline">Cambiar contraseña</button>
            </div>
          </div>
        </div>

        <div id="profileMessage" class="message" role="status"></div>
      </section>

      <!-- Usuarios -->
      <section id="section-usuarios" class="panel hidden">
        <h2>Usuarios</h2>
        <div class="card">
          <table id="usersTable">
            <thead>
              <tr><th>ID</th><th>Nombre</th><th>Email</th><th>Rol</th><th>Acciones</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Menú -->
      <section id="section-menu" class="panel hidden">
        <h2>Menú</h2>
        <div class="card">
          <button id="newMenuItem" class="btn">Nuevo plato</button>
          <table id="menuTable">
            <thead>
              <tr><th>ID</th><th>Nombre</th><th>Precio</th><th>Disponible</th><th>Acciones</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Pedidos (esqueleto) -->
      <section id="section-pedidos" class="panel hidden">
        <h2>Pedidos</h2>
        <div class="card">
          <p>Implementa la lista de pedidos y filtros aquí.</p>
        </div>
      </section>

    </section>
  </main>

  <!-- Modal Cambiar contraseña -->
  <div id="modalPassword" class="modal hidden">
    <div class="modal-content">
      <h3>Cambiar contraseña</h3>
      <label>Contraseña actual</label>
      <input id="oldPassword" type="password">
      <label>Nueva contraseña</label>
      <input id="newPassword" type="password">
      <label>Confirmar nueva contraseña</label>
      <input id="confirmPassword" type="password">
      <div class="actions">
        <button id="confirmChangePass" class="btn primary">Cambiar</button>
        <button id="cancelChangePass" class="btn outline">Cancelar</button>
      </div>
      <div id="passMessage" class="message"></div>
    </div>
  </div>

  <script src="js/admin_profile.js"></script>
</body>
</html>


/Html/css/admin_profile.css
/* Estilos limpios y simples, adaptables para mobile */
:root{--accent:#2b7a78;--muted:#6b7280;--bg:#f6f8fa}
*{box-sizing:border-box}
body{font-family:Inter,system-ui,Arial,Helvetica,sans-serif;margin:0;background:var(--bg);color:#111}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:#fff;border-bottom:1px solid #e6e6e6}
.brand{margin:0;font-size:18px}
.layout{display:flex;height:calc(100vh - 56px)}
.sidebar{width:220px;background:#fff;border-right:1px solid #e6e6e6;padding:16px}
.profile-mini{display:flex;gap:10px;align-items:center}
.profile-mini img{width:56px;height:56px;border-radius:8px;object-fit:cover}
.nav{margin-top:18px;display:flex;flex-direction:column;gap:8px}
.nav-btn{background:transparent;border:0;padding:8px 10px;text-align:left;cursor:pointer;border-radius:6px}
.nav-btn.active{background:#eef6f5}
.content{flex:1;padding:18px;overflow:auto}
.card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 1px 3px rgba(0,0,0,0.04)}
.profile-card{display:flex;gap:18px;align-items:flex-start}
.profile-card .left{width:160px;text-align:center}
.profile-card img{width:140px;height:140px;border-radius:12px;object-fit:cover}
input[type=text],input[type=email],input[type=password]{width:100%;padding:10px;margin:6px 0 12px;border:1px solid #ddd;border-radius:8px}
label{font-size:13px;color:var(--muted)}
.btn{padding:8px 12px;border-radius:8px;border:1px solid transparent;background:#fff;cursor:pointer}
.btn.small{padding:6px 8px}
.btn.primary{background:var(--accent);color:#fff}
.btn.outline{background:transparent;border:1px solid #ddd}
.actions{display:flex;gap:8px;margin-top:6px}
.hidden{display:none}
.message{margin-top:12px;color:var(--muted)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center}
.modal-content{background:#fff;padding:18px;border-radius:10px;width:360px}
@media(max-width:800px){.layout{flex-direction:column}.sidebar{width:100%;display:flex;flex-direction:row;gap:12px;align-items:center}.content{padding:12px}}


/Html/js/admin_profile.js
// Archivo cliente: hace peticiones a la API y maneja UI
const sections = document.querySelectorAll('.nav-btn');
const panels = {profile: document.getElementById('section-profile'), usuarios: document.getElementById('section-usuarios'), menu: document.getElementById('section-menu'), pedidos: document.getElementById('section-pedidos')};

sections.forEach(btn=>btn.addEventListener('click',()=>{
  document.querySelector('.nav-btn.active').classList.remove('active');
  btn.classList.add('active');
  Object.values(panels).forEach(p=>p.classList.add('hidden'));
  panels[btn.dataset.section].classList.remove('hidden');
}));

// Cargar perfil
async function loadProfile(){
  try{
    const res = await fetch('/api/admin/profile',{credentials:'include'});
    if(!res.ok) throw new Error('No autorizado');
    const data = await res.json();
    document.getElementById('name').value = data.name;
    document.getElementById('email').value = data.email;
    document.getElementById('phone').value = data.phone || '';
    document.getElementById('avatar').src = data.avatar || '/images/default-avatar.png';
    document.getElementById('avatarMini').src = data.avatar || '/images/default-avatar.png';
    document.getElementById('adminName').textContent = data.name;
  }catch(e){console.error(e)}
}

loadProfile();

// Guardar perfil
document.getElementById('saveProfile').addEventListener('click',async()=>{
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const res = await fetch('/api/admin/profile',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,email,phone}),credentials:'include'});
  const msg = document.getElementById('profileMessage');
  if(res.ok){msg.textContent='Perfil actualizado.';loadProfile();}else{msg.textContent='Error actualizando perfil.'}
});

// Cambiar avatar
const avatarInput = document.getElementById('avatarInput');
document.getElementById('changeAvatar').addEventListener('click',()=>avatarInput.click());
avatarInput.addEventListener('change',async()=>{
  const f = avatarInput.files[0];
  if(!f) return;
  const fd = new FormData(); fd.append('avatar', f);
  const res = await fetch('/api/admin/avatar',{method:'POST',body:fd,credentials:'include'});
  if(res.ok) {loadProfile();}
});

// Cambiar contraseña - modal
const modal = document.getElementById('modalPassword');
document.getElementById('changePasswordBtn').addEventListener('click',()=>modal.classList.remove('hidden'));
document.getElementById('cancelChangePass').addEventListener('click',()=>modal.classList.add('hidden'));
document.getElementById('confirmChangePass').addEventListener('click',async()=>{
  const oldP = document.getElementById('oldPassword').value;
  const newP = document.getElementById('newPassword').value;
  const confirm = document.getElementById('confirmPassword').value;
  const message = document.getElementById('passMessage');
  if(newP.length < 8){message.textContent='La contraseña debe tener al menos 8 caracteres.';return}
  if(newP !== confirm){message.textContent='Las contraseñas no coinciden.';return}
  const res = await fetch('/api/admin/change-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({oldPassword:oldP,newPassword:newP}),credentials:'include'});
  if(res.ok){message.textContent='Contraseña cambiada.';setTimeout(()=>modal.classList.add('hidden'),900);} else{message.textContent='Error al cambiar contraseña.'}
});

// Listar usuarios (básico)
async function loadUsers(){
  const res = await fetch('/api/admin/users',{credentials:'include'});
  if(!res.ok) return;
  const users = await res.json();
  const tbody = document.querySelector('#usersTable tbody'); tbody.innerHTML='';
  users.forEach(u=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${u.id}</td><td>${u.name}</td><td>${u.email}</td><td>${u.role}</td><td><button class='btn small' onclick='editUser(${u.id})'>Editar</button></td>`;
    tbody.appendChild(tr);
  });
}

loadUsers();

// Listar menú
async function loadMenu(){
  const res = await fetch('/api/admin/menu',{credentials:'include'});
  if(!res.ok) return;
  const items = await res.json();
  const tbody = document.querySelector('#menuTable tbody'); tbody.innerHTML='';
  items.forEach(it=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`<td>${it.id}</td><td>${it.name}</td><td>${it.price}</td><td>${it.available? 'Sí':'No'}</td><td><button class='btn small' onclick='editMenu(${it.id})'>Editar</button></td>`;
    tbody.appendChild(tr);
  });
}

loadMenu();

// Funciones placeholders para editar
window.editUser = id => alert('Abrir editor usuario: '+id);
window.editMenu = id => alert('Abrir editor menu: '+id);


/server/db.js
// mysql2/promise connection
const mysql = require('mysql2/promise');
require('dotenv').config();

const pool = mysql.createPool({
  host: process.env.DB_HOST || 'localhost',
  user: process.env.DB_USER || 'root',
  password: process.env.DB_PASS || '',
  database: process.env.DB_NAME || 'restaurante',
  waitForConnections: true,
  connectionLimit: 10,
});

module.exports = pool;


/server/middleware/auth.js
// Middleware sencillo: validar que haya sesión o token (a adaptar según tu sistema actual)
module.exports = function(req,res,next){
  // Ejemplo simple: si usas sesiones de express-session => req.session.admin
  if(req.session && req.session.admin && req.session.admin.id){
    req.admin = req.session.admin;
    return next();
  }
  // Si usas JWT, verifica aquí.
  res.status(401).json({error:'No autorizado'});
}


/server/controllers/adminController.js
const pool = require('../db');
const bcrypt = require('bcrypt');
const fs = require('fs');
const path = require('path');

exports.getProfile = async (req,res)=>{
  try{
    const [rows]=await pool.query('SELECT id,name,email,phone,avatar FROM admins WHERE id=?',[req.admin.id]);
    if(!rows.length) return res.status(404).json({error:'No encontrado'});
    res.json(rows[0]);
  }catch(e){console.error(e);res.status(500).json({error:'error'})}
}

exports.updateProfile = async (req,res)=>{
  const {name,email,phone} = req.body;
  try{
    await pool.query('UPDATE admins SET name=?, email=?, phone=? WHERE id=?',[name,email,phone,req.admin.id]);
    res.json({ok:true});
  }catch(e){console.error(e);res.status(500).json({error:'error'})}
}

exports.uploadAvatar = async (req,res)=>{
  if(!req.files || !req.files.avatar) return res.status(400).json({error:'No file'});
  const file = req.files.avatar;
  // Validaciones simples
  if(file.size > 2*1024*1024) return res.status(400).json({error:'Archivo muy grande'});
  const ext = path.extname(file.name).toLowerCase();
  const allowed = ['.png','.jpg','.jpeg','.webp'];
  if(!allowed.includes(ext)) return res.status(400).json({error:'Formato no permitido'});
  const filename = `avatar_${req.admin.id}${ext}`;
  const savePath = path.join(__dirname,'..','public','uploads',filename);
  await file.mv(savePath);
  await pool.query('UPDATE admins SET avatar=? WHERE id=?',[`/uploads/${filename}`,req.admin.id]);
  res.json({ok:true});
}

exports.changePassword = async (req,res)=>{
  const {oldPassword,newPassword} = req.body;
  try{
    const [rows]=await pool.query('SELECT password FROM admins WHERE id=?',[req.admin.id]);
    if(!rows.length) return res.status(404).json({error:'No existe'});
    const match = await bcrypt.compare(oldPassword, rows[0].password);
    if(!match) return res.status(400).json({error:'Contraseña incorrecta'});
    const hash = await bcrypt.hash(newPassword, 10);
    await pool.query('UPDATE admins SET password=? WHERE id=?',[hash,req.admin.id]);
    res.json({ok:true});
  }catch(e){console.error(e);res.status(500).json({error:'error'})}
}

// Usuarios y menú - ejemplos simples
exports.listUsers = async (req,res)=>{
  const [rows]=await pool.query('SELECT id,name,email,role FROM users ORDER BY id DESC');
  res.json(rows);
}

exports.listMenu = async (req,res)=>{
  const [rows]=await pool.query('SELECT id,name,price,available FROM menu ORDER BY id');
  res.json(rows);
}


/server/server.js
const express = require('express');
const session = require('express-session');
const fileUpload = require('express-fileupload');
const adminAuth = require('./middleware/auth');
const adminCtrl = require('./controllers/adminController');
require('dotenv').config();

const app = express();
app.use(express.json());
app.use(fileUpload());
app.use('/images', express.static('public/uploads'));
app.use(session({secret:process.env.SESSION_SECRET||'secret',resave:false,saveUninitialized:false}));

// Rutas de auth (ejemplo mínimo): /login que setee req.session.admin
app.post('/login', async (req,res)=>{
  // Implementa tu login real: buscar admin por email y comparar bcrypt
  res.json({ok:true});
});

// Rutas admin protegidas
app.get('/api/admin/profile', adminAuth, adminCtrl.getProfile);
app.put('/api/admin/profile', adminAuth, adminCtrl.updateProfile);
app.post('/api/admin/avatar', adminAuth, adminCtrl.uploadAvatar);
app.post('/api/admin/change-password', adminAuth, adminCtrl.changePassword);
app.get('/api/admin/users', adminAuth, adminCtrl.listUsers);
app.get('/api/admin/menu', adminAuth, adminCtrl.listMenu);

const PORT = process.env.PORT || 3000;
app.listen(PORT, ()=>console.log('Server running on',PORT));


.env.example
DB_HOST=localhost
DB_USER=root
DB_PASS=
DB_NAME=restaurante
SESSION_SECRET=tu_secreto_aqui


schema.sql
CREATE DATABASE IF NOT EXISTS restaurante;
USE restaurante;

CREATE TABLE IF NOT EXISTS admins(
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(150) NOT NULL,
  email VARCHAR(200) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  phone VARCHAR(50),
  avatar VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS users(
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(150),
  email VARCHAR(200) UNIQUE,
  role VARCHAR(50) DEFAULT 'cliente'
);

CREATE TABLE IF NOT EXISTS menu(
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(200) NOT NULL,
  description TEXT,
  price DECIMAL(8,2) NOT NULL,
  available TINYINT(1) DEFAULT 1
);

-- Crear un admin de prueba (reemplaza hash con bcrypt hash real)
INSERT INTO admins (name,email,password) VALUES ('Admin','admin@local','$2b$10$...');


README.md (resumen rápido de instalación)
1. Copia .env.example a .env y ajusta variables.
2. Ejecuta `npm install express mysql2 dotenv express-session express-fileupload bcrypt`.
3. Importa `schema.sql` en tu MySQL.
4. Ejecuta `node server/server.js`.
5. Abre `Html/admin_profile.html` (si usas rutas estáticas, sirve la carpeta Html desde express en producción).

Comandos Git para subir a GitHub:


git init
git add .
git commit -m "Perfil admin + backend"
git branch -M main
git remote add origin https://github.com/tu-usuario/tu-repo.git
git push -u origin main

Notas de seguridad:
- Guarda las contraseñas sólo con bcrypt.
- Usa prepared statements (mysql2 ya) y validaciones del lado servidor.
- Limita el tamaño y tipos de archivos en upload.
- En producción usa HTTPS y variables de entorno seguras.


Fin del paquete. Ajusta nombres y rutas según tu estructura actual.
